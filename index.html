<!DOCTYPE html>
<head>
<meta charset="utf-8">
<title>CodeSnippetGenerator</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script type="text/javascript">

var minliteralCount = 1;
var maxliteralCount = 16;
var literalAreas;

$(function() {

    $('#literal-plus').on('click', function() {
        var element = $('#literal-area .unit:last-child').clone(true);

        var inputList = element[0].querySelectorAll('input[type="text"], textarea');
        for (var i = 0; i < inputList.length; i++) {
            inputList[i].value = "";
        }
        $('#literal-area .unit').parent().append(element);
    });
    
    $('.literal-minus').on('click', function() {
        var inputCount = $('#literal-area .unit').length;
        if (inputCount > minliteralCount) {
            $(this).parents('.unit').remove();
        }
    });
});

function CreateFile() {
    let result = `<?xml version="1.0" encoding="utf-8"?>
<CodeSnippets xmlns="http://schemas.microsoft.com/VisualStudio/2005/CodeSnippet">
	<CodeSnippet Format="1.0.0">
		<Header>
			<Title>` + document.getElementById("title").value + `</Title>
			<Shortcut>` + document.getElementById("shortcut").value + "</Shortcut>\n";

            let authorValue = document.getElementById("author").value;
            if (authorValue != "") result += "<Author>" + authorValue + "</Author>/n";

            result += `</Header>
		<Snippet>
			<Code Language="` + document.getElementById("language").value + `">
				<![CDATA[` + document.getElementById("code").value + `]]>
			</Code>`;
            
        var literalforms = $('#literal-area .unit');
        var literals;
        for (var i = 0; i < literalforms.length; i++)
        {
            var inputList = literalforms[i].querySelectorAll('input[type="text"], textarea');
                if (inputList[0] == "") continue;

                literals += `<Literal>
                <ID>` + inputList[0] + `</ID>
                <ToolTip>` + inputList[1] + `</ToolTip>
                <Default>` + inputList[2] + `</Default>
            </Literal>\n`;
        }
        if (literals != "") result += "<Declarations>/n" + literals + "</Declarations>/n";

        var text = document.getElementById("imports").value.replace(/\r\n|\r/g, "\n");
        var lines = text.split( '\n' );
        var imports;
        for ( var i = 0; i < lines.length; i++ ) {
            if ( lines[i] == '') continue;
        
            imports += `<Import>
            <Namespace>` + lines[i] + `</Namespace>
            </Import>/n`;
        }
        if (imports != "") result += "<Imports>/n" + imports + "</Imports>/n";

        result += `</Snippet>
	</CodeSnippet>
</CodeSnippets>`;

return result;
}

function Download() {
    const a = document.createElement("a");
    document.body.appendChild(a);
    a.style = "display:none";

    const blob = new Blob([CreateFile()], { type: "octet/stream" });
    const url = window.URL.createObjectURL(blob);

    
    a.href = url;
    a.download = document.getElementById("title").value + ".codesnippet";
    a.click();
    window.URL.revokeObjectURL(url);
    a.parentNode.removeChild(a);
  }
</script>
</head>
<body>

<div class="container">

<h1>Visual Studio Code Snippet Generator</h1>

<div class="row">
<div class="card">
    <div class="card-header">
    <h2> Basic Infomation </h2>
    </div><div class="card-body">

  <div id="basic-area" class="form-group">
    <div class="input-group">
        <span class="input-group-text w-25">Title</span>
        <input type="text" class="form-control" id="title">
    </div>
    <div class="input-group">
        <span class="input-group-text w-25">Shortcut</span>
        <input type="text" class="form-control" id="shortcut">
    </div>
    <div class="input-group">
        <span class="input-group-text w-25">Author</span>
        <input type="text" class="form-control" id="author">
    </div>
    <div class="input-group">
        <span class="input-group-text w-25">Language</span>
        <input type="text" class="form-control" id="language" value="csharp">
    </div>
  </div>

    </div></div><div class="card">
    <div class="card-header">
    <h2> Code </h2>
    </div><div class="card-body">

<textarea id="code" class="form-control" name="code"></textarea>

    </div></div><div class="card">
    <div class="card-header">
    <h2> Liternals </h2>
    </div><div class="card-body">

  <div id="literal-area" class="form-group">
    <div class="unit">
        <div class="input-group">
            <span class="input-group-text w-25">ID</span>
            <input type="text" class="form-control" id="id">
        </div>
        <div class="input-group">
            <span class="input-group-text w-25">ToolTip</span>
            <input type="text" class="form-control" id="toolTip">
        </div>
        <div class="input-group">
            <span class="input-group-text w-25">Default</span>
            <input type="text" class="form-control" id="default">
        </div>
        <div class="demo-minus input-group-append">
            <span class="btn btn-danger">Ã—</span>
        </div>
    </div>
  </div>
  
  <input type="button" id="literal-plus" class="btn btn-primary" value="Add Literal" />

    </div></div><div class="card">
    <div class="card-header">
    <h2> Imports </h2>
    </div><div class="card-body">

    <textarea id="imports" class="form-control" name="imports"></textarea>

    </div></div>

    <input type="button" id="download" class="btn btn-success" value="Download" onclick="Download();" />

</div>
</body>
</html>
