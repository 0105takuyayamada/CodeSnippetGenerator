<!DOCTYPE html>
<head>
<meta charset="utf-8">
<title>CodeSnippetGenerator</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script type="text/javascript">

var minliteralCount = 1;
var maxliteralCount = 256;
var literalAreas;

$(function() {

    $('.literal-plus').on('click', function() {
        let element = $('#literal-area .unit:last-child').clone(true);

        let inputList = element[0].querySelectorAll('input[type="text"], textarea');
        for (let i = 0; i < inputList.length; i++) {
            inputList[i].value = "";
        }
        $('#literal-area .unit').parent().append(element);
    });
    
    $('.literal-minus').on('click', function() {
        let inputCount = $('#literal-area .unit').length;
        if (inputCount > minliteralCount) {
            $(this).parents('.unit').remove();
        }
	else {
	    let element = $('#literal-area .unit:last-child');
	    let inputList = element[0].querySelectorAll('input[type="text"], textarea');
	    for (let i = 0; i < inputList.length; i++) {
                inputList[i].value = "";
            }
	}
    });
});

function CreateFile() {
    let result = '<?xml version="1.0" encoding="utf-8"?>\n'
        + '<CodeSnippets xmlns="http://schemas.microsoft.com/VisualStudio/2005/CodeSnippet">\n'
        + '\t<CodeSnippet Format="1.0.0">\n'
        + "\t\t<Header>\n"
        + "\t\t\t<Title>" + document.getElementById("title").value + "</Title>\n"
        + "\t\t\t<Shortcut>" + document.getElementById("shortcut").value + "</Shortcut>\n";

    let authorValue = document.getElementById("author").value;
    if (authorValue != null) result += "\t\t\t<Author>" + authorValue + "</Author>\n"
    let langObject = document.getElementById("language");
    result += "\t\t\t</Header>\n"
    + "\t\t<Snippet>\n"
    + '\t\t\t<Code Language="' + langObject.options[langObject.selectedIndex].value
    + '">\n\t\t\t\t<![CDATA[' + document.getElementById("code").value + "]]></Code>\n\n";
            
    result += GetLiteralsText();
    result += GetImportsText();

    result += "\t\t</Snippet>\n\t</CodeSnippet>\n</CodeSnippets>";                
    return result;
}

function GetLiteralsText() {
    let literalforms = $('#literal-area .unit');
    let literals = "";
    let literalFlag = false;
    for (let i = 0; i < literalforms.length; i++)
    {
        let inputList = literalforms[i].querySelectorAll('input[type="text"], textarea');
            if (inputList[0].value == "") continue;
            literalFlag = true;
            literals += "\t\t\t\t<Literal>\n"
                + "\t\t\t\t\t<ID>" + inputList[0].value + "</ID>\n"
                + "\t\t\t\t\t<ToolTip>" + inputList[2].value + "</ToolTip>\n"
                + "\t\t\t\t\t<Default>" + inputList[1].value + "</Default>\n"
                + "\t\t\t\t</Literal>\n";
    }
    if (literalFlag) return "\t\t\t<Declarations>\n" + literals +  "\t\t\t</Declarations>\n\n";
    return "";
}

function GetImportsText() {
    let text = document.getElementById("imports").value.replace(/\r\n|\r/g, "\n");
        let lines = text.split( '\n' );
        let imports = "";
        let importFlag = false;

        for (let i = 0; i < lines.length; i++ ) {
            if ( lines[i] == "") continue;
            importFlag = true;
            imports += "\t\t\t\t<Import><Namespace>" + lines[i] + "</Namespace></Import>\n";
        }
        if (importFlag) return "\t\t\t<Imports>\n" + imports + "\t\t\t</Imports>\n\n";
        return "";
}

function Download() {
    const result = document.createElement("a");
    document.body.appendChild(result);
    result.style = "display:none";

    const blob = new Blob([CreateFile()], { type: "octet/stream" });
    const url = window.URL.createObjectURL(blob);
 
    result.href = url;
    result.download = document.getElementById("title").value + ".snippet";
    result.click();
    window.URL.revokeObjectURL(url);
    result.parentNode.removeChild(result);
  }

</script>

</head><body>
<div class="container">

<h1 style="text-align: center;">Visual Studio Code Snippet Generator</h1>

<div class="row">

    <div class="card col-md-7">
        <div class="card-header">
        <h2> Infomation </h2>
        </div><div class="card-body">

      <div id="basic-area" class="form-group">
        <div class="input-group">
            <span class="input-group-text w-25">Title*</span>
            <input type="text" class="form-control" id="title">
        </div>
        <div class="input-group">
            <span class="input-group-text w-25">Shortcut*</span>
            <input type="text" class="form-control" id="shortcut">
        </div>
        <div class="input-group">
            <span class="input-group-text w-25">Author</span>
            <input type="text" class="form-control" id="author">
        </div>
        <div class="input-group">
            <span class="input-group-text w-25">Language*</span>
            <select id="language" class="input-group-text">
                <option value="CSharp">CSharp</option>
                <option value="VB">VB</option>
                <option value="CPP">CPP</option>
                <option value="XAML">XAML</option>
                <option value="XML">XML</option>
                <option value="JavaScript">JavaScript</option>
                <option value="TypeScript">TypeScript</option>
                <option value="SQL">SQL</option>
                <option value="HTML">HTML</option>
              </select>
        </div>

        <div style="margin-bottom: 1em;"></div>

        <div class="input-group">
            <span class="input-group-text w-25">Imports</span>
            <textarea rows="1" id="imports" class="form-control" name="imports" placeholder='Example: System' wrap="off"></textarea>
        </div>
        <div class="input-group">
            <span class="input-group-text w-25">Code*</span>
            <textarea rows="5" id="code" class="form-control" name="code" placeholder='Reserved words: $selected$ $end$' wrap="off"></textarea>
        </div>

        <input type="button" id="download" class="btn btn-primary mt-3 md-3 w-100 d-none d-md-block" value="Download" onclick="Download();" />
      </div>
    </div>
    
    </div> 
        <div class="card col-md-5">
        
            <div class="card-header">
            <h2> Literals </h2>
            </div><div class="card-body">
            
          <input type="button" class="literal-plus btn btn-success w-100 mb-2" value="Add Literal" />
          <div id="literal-area" class="form-group">
            <div class="unit mb-1">
                <div class="input-group">
                    <span class="input-group-text w-25">ID</span>
                    <input type="text" class="form-control" id="id">
                </div>
        	<div class="input-group">
                    <span class="input-group-text w-25">Default</span>
                    <input type="text" class="form-control" id="default">
                </div>
                <div class="input-group">
                    <span class="input-group-text w-25">ToolTip</span>
                    <input type="text" class="form-control" id="toolTip">
                </div>
                <div class="literal-minus input-group-append w-25">
                    <span class="btn btn-secondary w-100" style="border-radius: 0 0 0.5rem 0.5rem; height:50%;">Ã—</span>
                </div>
            </div>
          </div> 
          <input type="button" class="literal-plus btn btn-success w-100 mt-1" value="Add Literal" />
      
        </div>
    </div>

</div>

<input type="button" id="download" class="btn btn-primary row w-100 d-block d-md-none" value="Download" onclick="Download();" />

</div>
</body></html>
