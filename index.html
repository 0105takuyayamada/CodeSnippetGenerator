<!DOCTYPE html>
<head>
<meta charset="utf-8">
<title>CodeSnippetGenerator</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script type="text/javascript">

var minliteralCount = 1;
var maxliteralCount = 16;
var literalAreas;

$(function(){

    $('#literal-plus').on('click', function() {
      var inputCount = $('#literal-area .unit').length;
      if (inputCount < maxliteralCount) {
        var element = $('#literal-area .unit:last-child').clone(true);
        var inputList = element[0].querySelectorAll('input[type="text"]');
        for (var i = 0; i < inputList.length; i++) {
          inputList[i].value = "";
        }
        $('#literal-area .unit').parent().append(element);
      }
    });
    $('.literal-minus').on('click', function() {
      var inputCount = $('#literal-area .unit').length;
      if (inputCount > minliteralCount) {
        $(this).parents('.unit').remove();
      }
    });

});

function CreateFile() {
    let result = `<?xml version="1.0" encoding="utf-8"?>
<CodeSnippets xmlns="http://schemas.microsoft.com/VisualStudio/2005/CodeSnippet">
	<CodeSnippet Format="1.0.0">
		<Header>
			<Title>` + document.getElementById("title").value + `</Title>
			<Shortcut>` + document.getElementById("shortcut").value + "</Shortcut>\n";

            let authorValue = document.getElementById("author").value;
            if (authorValue != "") result += "<Author>" + authorValue + "</Author>/n";

            result += `</Header>
		<Snippet>
			<Code Language="` + document.getElementById("language").value + `">
				<![CDATA[` + document.getElementById("code").value + `]]>
			</Code>`;
            
        var literalforms = $('#literal-area .unit').parent().querySelectorAll(`form-group`);
        var literals;
        for (var i = 0; i < literalforms.length; i++)
        {
            var inputList = literalforms[i].querySelectorAll('input[type="text"]');
                if (inputList.element[0] == "") continue;

                literals += `<Literal>
                <ID>` + inputList.element[0] + `</ID>
                <ToolTip>` + inputList.element[1] + `</ToolTip>
                <Default>` + inputList.element[2] + `</Default>
            </Literal>\n`;
        }
        if (literals.length > 0){
            result += "<Declarations>/n";
            literals.forEach(element => result += element);
            result += "</Declarations>/n";
        }

        var text = document.getElementById("imports").value.replace(/\r\n|\r/g, "\n");
        var lines = text.split( '\n' );
        var imports;
        for ( var i = 0; i < lines.length; i++ ) {
            // 空行は無視する
            if ( lines[i] == '' ) continue;
        
            imports.append(`<Import>
            <Namespace>` + lines[i] + `</Namespace>
            </Import>`);
        }
        if (imports.length > 0){
            result += "<Imports>/n";
            imports.forEach(element => {
                result += `<Import>
                <Namespace>` + element + `</Namespace>
                </Import>`;
            });
            result += "</Imports>/n";
        }

        result += `</Snippet>
	</CodeSnippet>
</CodeSnippets>`;

return result;
}

function Download() {
    const a = document.createElement("a");
    document.body.appendChild(a);
    a.style = "display:none";

    const blob = new Blob([CreateFile()], { type: "octet/stream" });
    const url = window.URL.createObjectURL(blob);

    
    a.href = url;
    a.download = document.getElementById("title").value + ".codesnippet";
    a.click();
    window.URL.revokeObjectURL(url);
    a.parentNode.removeChild(a);
  }
</script>
</head>
<body>

<div class="container">

<div class="row">

<h1>Visual Studio Code Snippet Generator</h1>

</div><div class="row">
  <h2> Basic Infomation </h2>

<table>
  <tr>
    <td>Title</td>
    <td><input type="text" id="title" name="title"></td>
  </tr>
  <tr>
    <td>Shortcut</td>
    <td><input type="text" id="shortcut" name="shortcut"></td>
  </tr>
  <tr>
  <td>Author</td>
  <td><input type="text" id="author" name="author"></td>
  </tr>
  <td>Language</td>
  <td><input type="text" id="language" name="language" value="csharp"></td>
  </tr>
</table>

</div><div class="row">

<h2> Code </h2>
<textarea id="code" name="code"></textarea>

</div><div class="row">

<h2> Liternals </h2>

  <div id="literal-area" class="form-group">
    <div class="input-group">
        <span class="input-group-text">ID</span>
        <input type="text" class="form-control" id="id">
    </div>
    <div class="input-group">
        <span class="input-group-text">ToolTip</span>
        <input type="text" class="form-control" id="toolTip">
    </div>
    <div class="input-group">
        <span class="input-group-text">Default</span>
        <input type="text" class="form-control" id="default">
    </div>
  </div>
  
  <input type="button" id="literal-plus" class="btn btn-primary" value="+" />

</div><div class="row">

<h2> Imports </h2>
<textarea id="imports" name="imports"></textarea>

</div><div class="row">

<input type="button" id="download" class="btn btn-success" value="Download" onclick="Download();" />

</div>

</body>
</html>
